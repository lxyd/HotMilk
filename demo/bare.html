<!DOCTYPE html>
<html lang="en-US">
	<head>
        <meta charset="utf-8">
		<title>HoTMiLk.js (HTML-embedded mustache templates) DEMO</title>
        <script src="../build/hotmilk.bare.js"></script>
        <script type="text/x-mustache-template" data-hotmilk-path="user/constructor">
            d
        </script>
        <script type="text/x-mustache-template" data-hotmilk-path="user/list">
            a
        </script>
        <script type="text/x-mustache-template" data-hotmilk-path="user/details">
            b
        </script>
        <script type="text/x-mustache-template" data-hotmilk-path="user/list#item">
            c
        </script>
        <script type="text/x-mustache-template" data-hotmilk-path="user#nameFormatted">
            d
        </script>
        <script>
            var grabTemplates = function() {
                var ss = document.getElementsByTagName('script');
                for(var i = 0; i < ss.length; i++) {
                    var s = ss[i], path;
                    if(s.type === 'text/x-mustache-template' && (path = s.getAttribute('data-hotmilk-path'))) {
                        if(s.src) {
                            var request = new XMLHttpRequest();
                            request.open('GET', s.src, true);
                            request.onreadystatechange = function() {
                                if (this.readyState === 4) {
                                    // file: queries return 0 instead of 200
                                    if(this.status === 200 || this.status === 0) {
                                        HotMilk.$addTemplate(path, this.responseText);
                                    }
                                }
                            };
                            request.send(null);
                        } else {
                            HotMilk.$addTemplate(path, s.text);
                        }
                    }
                };
            };
            var test = function() {
                console.log(HotMilk);
                console.log(HotMilk.user instanceof GroupNode);
                console.log(HotMilk.user.list instanceof TemplateNode);
                console.log(HotMilk.user.$ instanceof PartialsCollection);
                console.log(HotMilk.user.list.$.item instanceof Template);
            };
        </script>
	</head>
	<body onload="grabTemplates();test();">
	</body>
</html>
